# 多知识库使用指南

## 快速开始

### 1. 准备知识库文件夹

在 `text/` 下创建子文件夹，每个文件夹代表一个知识库：

```
text/
├── 医疗知识库/
│   └── （放入 .txt 或 .pdf 文件）
└── 商业知识库/
    └── （放入 .txt 或 .pdf 文件）
```

**重要**：文件夹名称必须与 `config.py` 中的配置完全一致。

### 2. 导入数据

```bash
# 批量导入所有知识库（推荐）
python ingest_data.py --all

# 导入到指定知识库
python ingest_data.py --folder ./my_docs --kb 医疗知识库
```

### 3. 验证导入

```bash
# 查看统计信息
python manage_knowledge_bases.py stats

# 测试搜索
python manage_knowledge_bases.py search "测试问题" --kb 医疗知识库
```

### 4. 启动系统

```bash
python app.py
```

访问 http://localhost:8000

## 常用命令

```bash
# 数据导入
python ingest_data.py --all                    # 批量导入所有知识库
python ingest_data.py --folder ./docs --kb XX # 导入到指定知识库

# 知识库管理
python manage_knowledge_bases.py list          # 列出所有知识库
python manage_knowledge_bases.py stats         # 查看统计信息
python manage_knowledge_bases.py search "问题" # 搜索知识库
```

## 添加新知识库

### 步骤1：修改 `config.py`

```python
self.knowledge_bases = {
    "医疗知识库": {
        "collection_name": "medical_knowledge",
        "description": "医疗、健康、疾病相关的专业知识"
    },
    "商业知识库": {
        "collection_name": "business_knowledge",
        "description": "商业、金融、管理相关的专业知识"
    },
    "法律知识库": {  # 新增
        "collection_name": "law_knowledge",
        "description": "法律、法规、案例相关的专业知识"
    }
}
```

### 步骤2：创建文件夹并导入

```bash
mkdir text/法律知识库
cp 法律文档.pdf text/法律知识库/
python ingest_data.py --all
```

## 工作原理

系统使用**两层决策**：

1. **Agent决策**：判断使用 RAG/搜索/对话 智能体
2. **知识库路由**：（使用RAG时）自动选择最相关的知识库

**示例**：
- 「高血压怎么治疗？」→ 医疗知识库
- 「如何制定营销策略？」→ 商业知识库  
- 「企业员工健康管理？」→ 医疗知识库 + 商业知识库

## 常见问题

**Q: 如何确认导入成功？**  
A: 运行 `python manage_knowledge_bases.py stats` 查看文档数量

**Q: 知识库名称配置错误怎么办？**  
A: 确保 `config.py` 中的名称与 `text/` 下的文件夹名称完全一致

**Q: 支持哪些文件格式？**  
A: 目前支持 `.txt` 和 `.pdf`

**Q: 如何删除知识库？**  
A: 从 `config.py` 删除配置，手动删除 `data/qdrant_db/` 对应数据

## 注意事项

- 知识库名称必须一致（config.py ↔ text/ 文件夹）
- Collection 名称必须唯一
- 所有知识库使用相同的 embedding 模型（1536维）
- 建议知识库数量：3-5个
- 准确配置知识库描述，有助于智能路由

## 调试技巧

Web界面的调试信息会显示：
- 选择的知识库：`selected_knowledge_bases`
- Agent类型：`decision_agent`
- LLM调用详情：`llm_calls`

快速检查：
```bash
python manage_knowledge_bases.py stats    # 查看各知识库文档数
python manage_knowledge_bases.py search "测试" --kb XX  # 测试检索效果
```

