# 项目结构说明

## 📁 核心目录结构

```
AgentM1/
├── app.py                    # FastAPI主应用，启动服务
├── config.py                 # 配置文件（API密钥、模型参数）
├── ingest_data.py            # 数据导入工具
├── requirements.txt          # 依赖包列表
│
├── agents/                   # 智能体模块
│   ├── agent_decision.py     # 决策系统（选择使用哪个Agent）
│   ├── conversation_agent.py # 对话Agent（日常健康咨询）
│   ├── rag_agent/           # RAG Agent（知识库检索）
│   └── web_search_agent/    # 网络搜索Agent（实时信息）
│
├── data/                     # 数据目录
│   └── qdrant_db/           # 向量数据库（自动生成）
│
└── text/                     # 知识文本文件
    └── 示例-高血压知识.txt
```

---

## 🚀 快速理解

### 1. 启动服务
```bash
python app.py
```
访问：http://localhost:8000

### 2. 导入知识数据
```bash
# 导入示例数据
python ingest_data.py --demo

# 导入自定义文本
python ingest_data.py --text "你的医学知识"
```

---

## 🔄 工作流程

```
用户提问
   ↓
agent_decision.py（决策：选择Agent）
   ↓
├─ RAG Agent → 知识库检索（专业知识）
├─ Web Search Agent → 网络搜索（最新信息）
└─ Conversation Agent → 对话生成（一般咨询）
   ↓
返回答案
```

---

## ⚙️ 关键配置

### config.py 主要参数

| 参数 | 说明 | 推荐值 |
|-----|------|-------|
| temperature | 生成随机性 | 0.1-0.7 |
| top_k | 检索文档数 | 5 |
| chunk_size | 文本分块大小 | 512 |
| min_retrieval_confidence | 检索置信度阈值 | 0.40 |

### 必需的环境变量（.env文件）

```bash
DASHSCOPE_API_KEY=sk-xxx           # 阿里云百炼API密钥
DASHSCOPE_MODEL_NAME=qwen-plus     # 模型名称
DASHSCOPE_EMBEDDING_MODEL=text-embedding-v2  # 向量模型
```

---

## 📂 核心文件说明

| 文件 | 功能 |
|-----|------|
| `app.py` | Web服务器，提供前端界面和API接口 |
| `config.py` | 所有配置和API密钥管理 |
| `ingest_data.py` | 将医学知识导入向量数据库 |
| `agent_decision.py` | 分析问题并决策使用哪个Agent |
| `rag_agent/` | 从知识库检索信息并生成答案 |
| `web_search_agent/` | 网络搜索最新医学信息 |
| `conversation_agent.py` | 一般对话和健康建议 |

---

## 🛠️ 技术栈

- **后端**: FastAPI + Uvicorn
- **LLM**: 阿里云百炼（通义千问）
- **向量数据库**: Qdrant（本地）
- **搜索引擎**: DuckDuckGo
- **前端**: 内嵌HTML（在app.py中）

---

## 💡 注意事项

1. **会话存储**: 当前使用内存，重启后丢失
2. **数据持久化**: 向量数据库存储在 `data/qdrant_db/`
3. **删除数据**: 直接删除 `data/qdrant_db/` 文件夹即可
4. **API密钥**: 确保在根目录创建 `.env` 文件并配置密钥

